<!DOCTYPE html>
<html lang="en" xmlns:th= "http://www.thymeleof.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Book</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" th:href="@{../css/base.css}">
    <link rel="stylesheet" th:href="@{../css/main.css}">
    <link rel="stylesheet" th:href="@{../css/order.css}">
    <link rel="stylesheet" th:href="@{../css/product_details.css}">
    <link rel="stylesheet" th:href="@{../css/gird.css}">
    <link rel="stylesheet" th:href="@{../css/responsive.css}">
    <style>
        .home-product-item__rating-text{
            font-size: 1.3rem;
            margin-bottom: -1.4px;
            margin-right: 5px;
        }
        .container__header-text {
            width: 100%;
            height: 200px;
            border: 1px solid #f5f5f5;
        }
        .fixed-size-text {
            padding: 4px 8px;
            width: 100%;
            height: 100%;
            resize: none;
            outline: none;
            border: 1px solid #817f7f;
            
        }
        .uk7Wpm {
        	display: inline-block;
		    padding: 2px 5px;
		    margin-left: 1.5em;
		    color: #ee4d2d;
		    border-radius: 1px;
		    border: 0.5px solid;
		    font-size: 10px;
		    text-transform: capitalize;
		    flex-shrink: 0;
		    cursor: pointer;
		}
		.none {
			display: none;
		}
    </style>
</head>
<body>
    <div class="main">
        <div th:replace="~{navi.html}"></div>
        <div class="container">
            <div class="container__details-sp" style="padding-bottom: 15px">
                <div class="grid wide">
                    <div class="container-details">
                        <div class="row c-gutter">
                                <!-- left -->
                            <div class="col l-4 m-4 c-12">
                                <div class="flex flex-column">
                                    <div class="U4yQzj">
                                        <div class="UuFd15">
                                        </div>
                                        <div class="container__left-img">
                                            <div class="VWiifV qO2bZw" th:style="'background-image: url(/uploads/' + ${userPDetail.imageB} + ');' + 'background-size: contain; background-repeat: no-repeat;'"></div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                                <!-- right -->
                            <div class="col l-8 m-8 c-12">
                                    <div class="flex-auto flex-column container__right-wrap">
                                        <!-- xếp hạng -->
                                        <div class="container__right-name">
                                            <span th:text="${userPDetail.nameB}"></span>
                                        </div>
                                        
                                        <div class="container__origin">Tác giả: <span th:text="${userPDetail.author}"></span></div>
                                        
                                        <div class="container__price">
                                            <div style="color: #757575; font-size: 1.4rem"><span>Số lượng</span></div>
                                            <div class="container__price-new"><span th:text="${userPDetail.amount}"></span></div>
                                        </div>
                                        
                                        <!-- phân loại kích thước màu sắc -->
                                        <form th:object="${rProduct}" th:action="@{/order/save/{id}(id = ${rProduct.rating})}" th:method="${rProduct.rating}<=0 ? POST : PUT" class="review-form">
                                        	<div class="input-rating" style="margin-top: 10px;">
							                    <span class="container__header-name" style="margin-left: 10px;">Xếp hạng: </span>
							                    <div class="stars" style="font-size: 1.4rem">
												    <input id="star5" name="rating" value="5" type="radio" th:checked="${rProduct.rating == 5}"><label for="star5"></label>
												    <input id="star4" name="rating" value="4" type="radio" th:checked="${rProduct.rating == 4}"><label for="star4"></label>
												    <input id="star3" name="rating" value="3" type="radio" th:checked="${rProduct.rating == 3}"><label for="star3"></label>
												    <input id="star2" name="rating" value="2" type="radio" th:checked="${rProduct.rating == 2}"><label for="star2"></label>
												    <input id="star1" name="rating" value="1" type="radio" th:checked="${rProduct.rating == 1}"><label for="star1"></label>
												</div>
												<div th:if="${userPDetail.status} == 0" style="display: inline-block;">	                                                        	
							                    	<div th:if ="${timeR} <= 4" class="uk7Wpm" id="btn_rating--edit" th:text="${rProduct.rating > 0 ? 'Thay đổi':'Đánh giá'}"></div>
							                    	<div th:if ="${timeR} > 4" class="uk7Wpm" id="btn_rating--noedit">Hết thời gian thay đổi đánh giá</div>
							                    </div>							                    
							                </div>
                                        	<input type="hidden" name="idb" th:value="${userPDetail.idB}">
                                        	<input type="hidden" name="ido" th:value="${userPDetail.idO}">                               
	                                        <div class="container__header">
	                                            <div class="container__header-wrap" style="display: block;">
	                                                <div><Label class="container__header-name">Nhận xét</Label></div>
	                                                <div class="container__header-list">
	                                                    <div class="container__header-text">
	                                                        <textarea class="fixed-size-text" name="comment" id="" cols="30" rows="10" placeholder="Nhận xét/Bình luận về sản phẩm" th:value="${rProduct.comment}" th:text="${rProduct.comment}"></textarea>
	                                                    </div>
	                                                </div>
	                                            </div>
	                                        </div>
	                                        
	                                            <!-- dtn -->
	                                            <div style="margin-top: 40px; margin-bottom: 20px">
	                                                <div class="container__right-purchase-wrap">
	                                                    <div class="container__right-purchase-btn" style="display: flex; flex-direction: row; justify-content: space-between;">
	                                                    	<div style="display: flex;">
		                                                        <button class="btn btn-tinted btn--l container__right-purchase-btn__cart iFo-rx" type="button"aria-disabled="false" onclick="location.href='/order';"><span>Trở về</span></button>		                                             
		                                                        <button id="btn_rating--save" class="btn btn-solid-primary btn--l container__right-purchase-btn__buy iFo-rx" aria-disabled="false">Đánh giá</button>
	                                                    	</div>
	                                                        <div th:if="${checkR} == 0">
															    <a th:href="'remove-order?idb='+${userPDetail.idB}+'&amp;ido='+${userPDetail.idO}"
															       id="btn_rating--remove"
															       class="btn btn-solid-primary btn--l container__right-purchase-btn__buy iFo-rx"
															       aria-disabled="false"
															       onclick="return confirm('Bạn có chắc chắn muốn hủy đặt hàng không?')">Hủy đặt hàng</a>
															</div>
	                                                        
	                                                    </div>
	                                                    
	                                                </div>
	                                            </div>
                                            </form>
                                        </div>
                                       
                                    </div>
                                    <script src="./javascript/user_product.js"></script>
					                <script>
					                	
						            	const save = document.getElementById("btn_rating--save");
						            	const edit = document.getElementById("btn_rating--edit");
						            	const noedit = document.getElementById("btn_rating--noedit");
						            	if(noedit != undefined){
						            		save.style.display ="none";
						            		edit.style.display ="flex";
						            		var inputs = document.querySelectorAll('input, textarea,.container__header-btn');
												
						            		// Lặp qua danh sách các phần tử input và textarea và thêm/xoá thuộc tính readonly và disabled
						            		//document.querySelector('.custom-file-upload').style.cu
						            		inputs.forEach(function(input) {
						            		    input.setAttribute('readonly', 'readonly');
						            		    input.setAttribute('disabled', 'disabled');
						            		  
						            		});
						            	}
						            	else if(edit != undefined){
						            		save.style.display ="none";
						            		edit.style.display ="flex";
						            		var inputs = document.querySelectorAll('input, textarea,.container__header-btn');
												
						            		// Lặp qua danh sách các phần tử input và textarea và thêm/xoá thuộc tính readonly và disabled
						            		//document.querySelector('.custom-file-upload').style.cu
						            		inputs.forEach(function(input) {
						            		    input.setAttribute('readonly', 'readonly');
						            		    input.setAttribute('disabled', 'disabled');
						            		  
						            		});
						
						            		edit.addEventListener('click', function(e){
						            			e.preventDefault();
						            			save.style.display='flex';
						            			edit.style.display ="none";
						            			inputs.forEach(function(input) {
						                  		  if (input.hasAttribute('readonly') || input.hasAttribute('disabled')) {
						                  		    input.removeAttribute('readonly');
						                  		    input.removeAttribute('disabled');
						                  		  } else {
						                  		    input.setAttribute('readonly', 'readonly');
						                  		    input.setAttribute('disabled', 'disabled');
						                  		  }
						                  		});
						            		});
						            	}
					            	</script>
                            </div>
                        </div>
                    </div>
                </div>
            <div th:replace="~{footer.html}"></div>
            <div th:if="${success} !=null" id="add-to-cart-popup" class="hidden">
	            <div class="add-to-cart-icon">
	                <i class="fa-regular fa-circle-check"></i>
	            </div>
	            <div class="add-to-cart-text">
	                <p th:text="${success}"></p>
	            </div>
	        </div>
	        <script>
		        const addToCartPopup = document.getElementById('add-to-cart-popup');
		        
		        // Kiểm tra xem div thông báo có tồn tại không
		        if (addToCartPopup !== null) {
		            // Hiển thị div thông báo
		            addToCartPopup.classList.add('show');
		            // Tự động ẩn div thông báo sau
		            setTimeout(function() {
		            	addToCartPopup.classList.remove('show');
		                
		            }, 1000);
		        }
	        </script>
    	</div>
           
	</div>
</body>
</html>